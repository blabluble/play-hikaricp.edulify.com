<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>play-hikaricp by edulify</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">play-hikaricp</h1>
      <h2 class="project-tagline">HikariCP Plugin for Play 2.2.x and 2.3.x</h2>
      <a href="https://github.com/edulify/play-hikaricp.edulify.com" class="btn">View on GitHub</a>
      <a href="https://github.com/edulify/play-hikaricp.edulify.com/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/edulify/play-hikaricp.edulify.com/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="hikaricp-plugin-for-23x" class="anchor" href="#hikaricp-plugin-for-23x" aria-hidden="true"><span class="octicon octicon-link"></span></a>HikariCP Plugin for 2.3.x</h1>

<blockquote>
<p>This plugin is not necessary for applications using using <strong>Play 2.4.0</strong> because HikariCP is <a href="https://playframework.com/documentation/2.4.x/Highlights24#HikariCP">the default pool for Play 2.4.0</a>. Anyway, we will try to keep this plugin updated with HikariCP releases to support developers using Play 2.3.x.</p>
</blockquote>

<p>This plugin works with <code>2.3.x</code> of PlayFramework and uses version <code>2.3.8</code> of HikariCP.</p>

<p>Note, it can be made to work with Play <code>2.2.x</code> (or 2.3.x) of the PlayFramework, but it requires changing the dependencies as the current build relies on the Play <code>2.3.x</code> plugin. Please, see the versions table below to see which version of Play is supported.</p>

<p><a href="https://travis-ci.org/edulify/play-hikaricp.edulify.com"><img src="https://travis-ci.org/edulify/play-hikaricp.edulify.com.svg?branch=master" alt="Build Status"></a> <a href="http://issuestats.com/github/edulify/play-hikaricp.edulify.com"><img src="http://issuestats.com/github/edulify/play-hikaricp.edulify.com/badge/pr" alt="Issue Stats"></a> <a href="https://www.versioneye.com/user/projects/54eaa687d1ec577c97000cd5"><img src="https://www.versioneye.com/user/projects/54eaa687d1ec577c97000cd5/badge.svg?style=flat" alt="Dependency Status"></a> <a href="https://coveralls.io/r/edulify/play-hikaricp.edulify.com?branch=master"><img src="https://coveralls.io/repos/edulify/play-hikaricp.edulify.com/badge.svg?branch=master" alt="Coverage Status"></a> <a href="https://www.codacy.com/public/contact_4/play-hikaricp.edulify.com"><img src="https://www.codacy.com/project/badge/9817a5d0538b434eb052ce5917a7ae9d" alt="Codacy Badge"></a></p>

<h2>
<a id="about-this-documentation" class="anchor" href="#about-this-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>About this documentation</h2>

<p>When reading this documentation at Github, select the tag that matches the version of the plugin that you are using.</p>

<h2>
<a id="why-hikaricp" class="anchor" href="#why-hikaricp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why HikariCP?</h2>

<p><a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> is supposed to be the fastest connection pool in Java land. But we did not start to use it because of speed, but because of its reliability. After suffering with connection leaks from BoneCP, we decide to implement our own database plugin to replace the default one. You can see <a href="https://groups.google.com/forum/#!topic/play-framework/7PBnjiXkNuU">a discussion about database exceptions</a> caused by BoneCP (or misconfiguration of it). Also there are numerous other discussions about people having problems related to BoneCP.</p>

<p>Here is how HikariCP is working for us:</p>

<p><img src="http://i.imgur.com/xPqkc7T.png" alt="HikariCP in Production"></p>

<h2>
<a id="versions" class="anchor" href="#versions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Versions</h2>

<table>
<thead>
<tr>
<th align="right">Version</th>
<th align="right">HikariCP</th>
<th align="right">Play</th>
<th align="left">Docs reference</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">2.1.0</td>
<td align="right">2.4.3</td>
<td align="right">2.3.10</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.1.0/README.md">Release 2.1.0</a></td>
</tr>
<tr>
<td align="right">2.0.6</td>
<td align="right">2.3.8</td>
<td align="right">2.3.9</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.6/README.md">Release 2.0.6</a></td>
</tr>
<tr>
<td align="right">2.0.5</td>
<td align="right">2.3.7</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.5/README.md">Release 2.0.5</a></td>
</tr>
<tr>
<td align="right">2.0.4</td>
<td align="right">2.3.6</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.4/README.md">Release 2.0.4</a></td>
</tr>
<tr>
<td align="right">2.0.3</td>
<td align="right">2.3.5</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.3/README.md">Release 2.0.3</a></td>
</tr>
<tr>
<td align="right">2.0.2</td>
<td align="right">2.3.2</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.2/README.md">Release 2.0.2</a></td>
</tr>
<tr>
<td align="right">2.0.1</td>
<td align="right">2.3.2</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.1/README.md">Release 2.0.1</a></td>
</tr>
<tr>
<td align="right">2.0.0</td>
<td align="right">2.3.2</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/2.0.0/README.md">Release 2.0.0</a></td>
</tr>
<tr>
<td align="right">1.5.2</td>
<td align="right">2.3.2</td>
<td align="right">2.3.8</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.5.2/README.md">Release 1.5.2</a></td>
</tr>
<tr>
<td align="right">1.5.1</td>
<td align="right">2.2.5</td>
<td align="right">2.3.7</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.5.1/README.md">Release 1.5.1</a></td>
</tr>
<tr>
<td align="right">1.5.0</td>
<td align="right">2.0.1</td>
<td align="right">2.3.4</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.5.0/README.md">Release 1.5.0</a></td>
</tr>
<tr>
<td align="right">1.4.1</td>
<td align="right">2.0.1</td>
<td align="right">2.3.2</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.4.1/README.md">Release 1.4.1</a></td>
</tr>
<tr>
<td align="right">1.4.0</td>
<td align="right">1.4.0</td>
<td align="right">2.3.1</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.4.0/README.md">Release 1.4.0</a></td>
</tr>
<tr>
<td align="right">1.3.1</td>
<td align="right">1.3.8</td>
<td align="right">2.3.1</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.3.1/README.md">Release 1.3.1</a></td>
</tr>
<tr>
<td align="right">1.3.0</td>
<td align="right">1.3.8</td>
<td align="right">2.3.1</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.3.0/README.md">Release 1.3.0</a></td>
</tr>
<tr>
<td align="right">1.2.0</td>
<td align="right">1.3.8</td>
<td align="right">2.2.3</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.2.0/README.md">Release 1.2.0</a></td>
</tr>
<tr>
<td align="right">1.1.0</td>
<td align="right">1.3.8</td>
<td align="right">2.2.3</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.1.0/README.md">Release 1.1.0</a></td>
</tr>
<tr>
<td align="right">1.0.0</td>
<td align="right">1.3.5</td>
<td align="right">2.2.2</td>
<td align="left"><a href="https://github.com/edulify/play-hikaricp.edulify.com/blob/1.1.0/README.md">Release 1.0.0</a></td>
</tr>
</tbody>
</table>

<p>For more information about what changed in each version, see the CHANGELOG.md file.</p>

<h2>
<a id="repository" class="anchor" href="#repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Repository</h2>

<p>You need to add the following repository in order to use this module:</p>

<div class="highlight highlight-source-scala"><pre>resolvers <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-en">Resolver</span>.url(<span class="pl-s"><span class="pl-pds">"</span>Edulify Repository<span class="pl-pds">"</span></span>, url(<span class="pl-s"><span class="pl-pds">"</span>https://edulify.github.io/modules/releases/<span class="pl-pds">"</span></span>))(<span class="pl-en">Resolver</span>.ivyStylePatterns)</pre></div>

<h2>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to Use</h2>

<p>There are just a few steps to properly configure the plugin:</p>

<h3>
<a id="step-1-add-the-dependency" class="anchor" href="#step-1-add-the-dependency" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1: Add the dependency</h3>

<p>Add the following dependency to your <code>project/build.sbt</code> or <code>project/Build.scala</code>:</p>

<pre><code>"com.edulify" %% "play-hikaricp" % "2.1.0"
</code></pre>

<h3>
<a id="step-2-disable-default-dbplugin" class="anchor" href="#step-2-disable-default-dbplugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Disable default <code>dbplugin</code>
</h3>

<p>Add the following line to your <code>conf/application.conf</code>:</p>

<pre><code>dbplugin=disabled
</code></pre>

<p>This will disable <code>dbplugin</code> and avoids that BoneCP creates useless connections (which in some cases can create database problems, like exhaust available connections).</p>

<h3>
<a id="step-3-enable-hikaricp-plugin" class="anchor" href="#step-3-enable-hikaricp-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: Enable HikariCP Plugin</h3>

<p>Add the following line to your <code>conf/play.plugins</code>:</p>

<pre><code>200:com.edulify.play.hikaricp.HikariCPPlugin
</code></pre>

<p>Due to the fact that the <a href="https://github.com/playframework/playframework/blob/master/framework/src/play-java-jpa/src/main/resources/play.plugins">Play JPA plugin</a> is assigned a priority of <strong>400</strong>, please make sure that you assign <code>com.edulify.play.hikaricp.HikariCPPlugin</code> a priority less than that when using datasources looked up via JNDI. Otherwise, during application startup when JPA attempts to create the <code>EntityManagerFactory</code> your data source will not have been bound to JNDI yet. <a href="http://playframework.com/documentation/2.3.x/ScalaPlugins">Play documentation</a> states that connection pools should use a <strong>200</strong> priority.</p>

<h3>
<a id="step-4-configure-hikaricp" class="anchor" href="#step-4-configure-hikaricp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4: Configure HikariCP</h3>

<p>Please, before reading this section, we recommend that you get familiarized with <a href="https://github.com/brettwooldridge/HikariCP#configuration-knobs-baby">HikariCP configurations</a>. It is the main source to understand each possible configuration for HikariCP and it have invaluable information about how to best configure your pool. We also recommends that you read about <a href="https://github.com/typesafehub/config">Typesafe Config</a>, which is the configuration language used by PlayFramework.</p>

<p>This plugin just read each possible HikariCP configuration and create the pool from it, with all the defaults honored. Here is a simple example of how to configure your pool in <code>application.conf</code>:</p>

<pre><code>db {
  default {
    driverClassName=org.postgresql.Driver
    jdbcUrl="jdbc:postgresql://localhost/simpsons"
    username=bart
    password=51mp50n
  }
}
</code></pre>

<p>Alternatively, you can configure it using some implementation of <code>javax.sql.DataSource</code> provided by your JDBC Driver:</p>

<pre><code>db {
  default {
    dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
    dataSource {
      user=bart
      password=51mp50n
      databaseName=springfield
      serverName=localhost
    }
  }
}
</code></pre>

<p>HikariCP documentation has a <a href="https://github.com/brettwooldridge/HikariCP#popular-datasource-class-names">list of JDBC DataSource classes for popular databases</a>. Both <code>dataSourceClassName</code> and <code>jdbcUrl</code> are supported, but HikariCP recommends the former. Also, you can configure more than one database:</p>

<pre><code>db {

  default {
    dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
    dataSource {
      user=bart
      password=51mp50n
      databaseName=springfield
      serverName=localhost
    }
  }

  orders {
    dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
      dataSource {
        user=homer
        password=duffbeer
        databaseName=orders
        serverName=localhost
      }
    }
}
</code></pre>

<h2>
<a id="log-sql-statements" class="anchor" href="#log-sql-statements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Log SQL statements</h2>

<p>HikariCP does not offer (out of the box) a way to log SQL statements and it suggests that you use the log capacities of your database vendor. From HikariCP docs:</p>

<blockquote>
<p><strong>Log Statement Text / Slow Query Logging</strong></p>

<p>Like Statement caching, most major database vendors support statement logging through properties of their own driver. This includes Oracle, MySQL, Derby, MSSQL, and others. Some even support slow query logging. We consider this a "development-time" feature. For those few databases that do not support it, jdbcdslog-exp is a good option. Great stuff during development and pre-Production.</p>
</blockquote>

<p>We take the suggestion of using <a href="https://code.google.com/p/jdbcdslog-exp/">jdbcdslog-exp</a> and have implemented SQL log statement support, which can be configured by database, using <code>logSql</code> property:</p>

<pre><code>db {
  default {

    logSql=true

    dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
    dataSource {
      user=bart
      password=51mp50n
      databaseName=springfield
      serverName=localhost

    }
  }
}
</code></pre>

<p>After that, you can configure the jdbcdslog-exp <a href="https://code.google.com/p/jdbcdslog/wiki/UserGuide#Setup_logging_engine">log level as explained in their manual</a>. Basically, you need to configure your root logger to <code>INFO</code> and then decide what jdbcdslog-exp will log (connections, statements and result sets). Here is an example using <code>conf/application.conf</code> to configure the logs:</p>

<pre><code>logger.root=INFO
logger.org.jdbcdslog.ConnectionLogger=ERROR # won't log connections
logger.org.jdbcdslog.StatementLogger=INFO   # log all statements
logger.org.jdbcdslog.ResultSetLogger=ERROR  # won't log result sets
</code></pre>

<p>Keep in mind that <strong>this is intended to be used just in development environments</strong> and you should not configure it in production, since there is a performance degradation and it will polute your logs.</p>

<h2>
<a id="jndi-support" class="anchor" href="#jndi-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>JNDI Support</h2>

<p>Thanks to contributions from the community, this plugin supports to bind a DataSource to a JNDI context. Here is an example of how to add configure it in <code>conf/application.conf</code>:</p>

<pre><code>db {
  default {

    jndiName="DefaultDataSource"

    dataSourceClassName=org.postgresql.ds.PGSimpleDataSource
    dataSource {
      user=bart
      password=51mp50n
      databaseName=springfield
      serverName=localhost
    }
  }
}
</code></pre>

<h2>
<a id="using-with-slick" class="anchor" href="#using-with-slick" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using with Slick</h2>

<p><a href="https://github.com/playframework/play-slick">play-slick</a> requires a <code>db.&lt;database&gt;.driver</code> property to be configured. So, besides your pool configuration, when using Slick, you also have to configure this property. Per instance:</p>

<pre><code>db {
  default {
    driver=org.postgresql.Driver
    driverClassName=${db.default.driver}
    jdbcUrl="jdbc:postgresql://localhost/simpsons"
    username=bart
    password=51mp50n
  }
}
</code></pre>

<p>Notice that the driver was repeated in two different properties, even if one is reference the other. After that, play-slick is smart enough to use the configured pool.</p>

<h2>
<a id="deploying-to-heroku" class="anchor" href="#deploying-to-heroku" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deploying to Heroku</h2>

<p>When using Heroku, a <code>DATABASE_URL</code> environment variable in the form <code>scheme://user:password@host:port/db</code> will be created for you. This variable can be used directly inside <code>application.conf</code>:</p>

<pre><code>db {
  default {
    driverClassName=org.postgresql.Driver
    databaseUrl=${DATABASE_URL}
  }
}
</code></pre>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h2>

<p>You can see a full list of contributors <a href="https://github.com/edulify/play-hikaricp.edulify.com/graphs/contributors">here</a>. Thank you very much to all the people that helps us to maintain and evolve this plugin.</p>

<h2>
<a id="inspirations-and-alternatives" class="anchor" href="#inspirations-and-alternatives" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inspirations and Alternatives</h2>

<p>The code here is highly inspired by the following plugins:</p>

<ol>
<li><a href="https://github.com/swaldman/c3p0-play">swaldman/c3p0-play</a></li>
<li><a href="https://github.com/autma/play-hikaricp-plugin">autma/play-hikaricp-plugin</a></li>
</ol>

<p>We decide to do our own because both plugins above looks unmaintained.</p>

<p>There are also two other alternatives using c3p0:</p>

<ol>
<li><a href="https://github.com/hadashi/play2-c3p0-plugin">hadashi/play2-c3p0-plugin</a></li>
<li><a href="https://github.com/Furyu/play-c3p0-plugin">Furyu/play-c3p0-plugin</a></li>
</ol>

<h2>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<ol>
<li>
<a href="https://github.com/brettwooldridge/HikariCP">HikariCP Configuration</a>: See information about what can be configured, supported data sources and drivers</li>
<li>
<a href="https://playframework.com/documentation/2.3.x/ScalaPlugins">Play Plugins Docs</a>: Understand how plugins are created and configured</li>
<li>
<a href="https://github.com/typesafehub/config">Typesafe Config</a>: What is supported and help with the syntax</li>
<li>
<a href="https://code.google.com/p/jdbcdslog-exp/">jdbcdslog-exp</a>: How to configure the logSql enabler</li>
<li>
<a href="https://www.playframework.com/documentation/2.3.x/ProductionHeroku">Heroku Docs</a>: Docs about how to deploy Play applications to Heroku.</li>
</ol>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright 2014 Edulify.com</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/edulify/play-hikaricp.edulify.com">play-hikaricp</a> is maintained by <a href="https://github.com/edulify">edulify</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
